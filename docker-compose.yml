version: '3'
services:
  bitcoin_mainnet:
    build: dockers/bitcoin/
    environment:
      - BTC_CONF=/root/bitcoin.conf
    volumes:
      - ./data/bitcoin:/data
    # ports:
      # - "8332:8332"

  bitcoin_testnet:
    build: dockers/bitcoin/
    environment:
      - BTC_CONF=/root/testnet.conf
    volumes:
      - ./data/bitcoin_testnet:/data

  insight_mainnet:
    build: dockers/insight/
    ports:
      - "3001:3000"
    depends_on:
      - bitcoin_mainnet

  insight_testnet:
    build: dockers/insight/
    ports:
      - "3002:3000"
    depends_on:
      - bitcoin_testnet

  rsk_mainnet:
    build: dockers/rsk/
    environment:
      - RSK_CONF=/etc/rsk/mainnet.conf
    volumes:
      - ./data/rsk_mainnet:/var/lib/rsk/database/mainnet

  rsk_testnet:
    build: dockers/rsk/
    environment:
      - RSK_CONF=/etc/rsk/testnet.conf
    volumes:
      - ./data/rsk_testnet:/var/lib/rsk/database/testnet

  rsk_mainnet_explorer:
    build: dockers/explorer/
    environment:
      - MONGO_URI=mongodb://crypto_mongodb_1/blockDB
      - EXPLORER_CONFIG=/usr/src/explorer/mainnet.json
    ports:
      - "3003:3000"
    restart: unless-stopped
    depends_on:
      - rsk_mainnet
      - mongodb

  rsk_testnet_explorer:
    build: dockers/explorer/
    environment:
      - MONGO_URI=mongodb://crypto_mongodb_1/blockDBTestnet
      - EXPLORER_CONFIG=/usr/src/explorer/testnet.json
    ports:
      - "3004:3000"
    restart: unless-stopped
    depends_on:
      - rsk_testnet
      - mongodb

  mongodb:
    image: mongo:latest
    environment:
      - MONGO_DATA_DIR=/data/db
      - MONGO_LOG_DIR=/dev/null
    volumes:
      - ./data/mongodb:/data/db
    # ports:
      # - 27017:27017
    command: mongod --smallfiles --logpath=/dev/null # --quiet

  ganache:
    image: trufflesuite/ganache-cli:latest
    # ports:
      # - "8545:8545"

  truffle:
    build: dockers/truffle/
    ports:
      - "3000:8080"
    depends_on:
      - rsk_mainnet
      - rsk_testnet
      - ganache
